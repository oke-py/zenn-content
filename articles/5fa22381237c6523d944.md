---
title: "kindã§ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’æœ‰åŠ¹åŒ–ã™ã‚‹è¨­å®š"
emoji: "ğŸ’­"
type: "tech"
topics: ["kubernetes"]
published: true
---

## ã¯ã˜ã‚ã«

kindã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§[ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ](https://kubernetes.io/ja/docs/concepts/workloads/pods/ephemeral-containers/)ãŒã†ã¾ãå‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚åŸå› ã¯ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€å›é¿ç­–ã‚’è¦‹ã¤ã‘ãŸãŸã‚å…±æœ‰ã—ã¾ã™ã€‚

## TL;DR

```yaml:config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
featureGates:
  EphemeralContainers: true
```

```
$ kind create cluster --config config.yaml
```

## ç’°å¢ƒ

```
$ kind version
kind v0.11.1 go1.16.4 darwin/arm64
```

## NGä¾‹

ã€[Kuberneteså®Œå…¨ã‚¬ã‚¤ãƒ‰ ç¬¬2ç‰ˆ](https://book.impress.co.jp/books/1119101148)ã€P.37 ãƒªã‚¹ãƒˆ 3.2ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

```yaml:config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
kubeadmConfigPatches:
- |-
  apiVersion: kubeadm.k8s.io/v1beta2
  kind: ClusterConfiguration
  metadata:
    name: config
  apiServer:
    extraArgs:
      "feature-gates": "EphemeralContainers=true"
```

[Debugging with an ephemeral debug container](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container)ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

```
$ kubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never

$ kubectl debug -it ephemeral-demo --image=busybox --target=ephemeral-demo
Defaulting debug container name to debugger-8xzrl.
```

ã“ã“ã‹ã‚‰é€²ã¾ãšã€ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

## OKä¾‹

èª¿ã¹ã¦ã„ã‚‹ã¨[Ephemeral containers using kubectl-debug does not seem to work](https://github.com/kubernetes-sigs/kind/issues/1210)ã¨ã„ã†Issueã«è¡Œãç€ãã¾ã—ãŸã€‚ã‚³ãƒ¡ãƒ³ãƒˆã§è¨­å®šä¾‹ãŒæç¤ºã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

```yaml:config.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
featureGates:
  EphemeralContainers: true
```

å†åº¦ã€[Debugging with an ephemeral debug container](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container)ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

```
$ kubectl run ephemeral-demo --image=k8s.gcr.io/pause:3.1 --restart=Never

$ kubectl debug -it ephemeral-demo --image=busybox --target=ephemeral-demo
Defaulting debug container name to debugger-dls8z.
If you don't see a command prompt, try pressing enter.
/ #
```

## ãŠã‚ã‚Šã«

ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ä¸‡ã€…æ­³ã€‚ã¨æ€ã„ãã‚„ã€ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹æ–¹æ³•ãŒã‚ã‹ã‚‰ãšã€æœ¬æ¥ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚quay.io/prometheus/prometheus:v2.26.0ã®Prometheusè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¦å‹•ä½œç¢ºèªã—ãŸã‹ã£ãŸã®ã§ã™ãŒãƒ»ãƒ»ãƒ»

## å‚è€ƒ

- [Ephemeral containers using kubectl-debug does not seem to work](https://github.com/kubernetes-sigs/kind/issues/1210)
- [Debugging with an ephemeral debug container](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container)
